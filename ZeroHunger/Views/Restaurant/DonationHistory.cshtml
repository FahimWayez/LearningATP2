@{
    ViewBag.Title = "Donation History";
}

<div class="container">
    <a href="@Url.Action("Filter", "Restaurant")" class="btn btn-link mb-3">Back to Filter</a>
    <h2 class="text-center">@ViewBag.Title</h2>
    <div class="table-responsive">
        <table class="table table-striped table-bordered">
            <thead class="thead-dark">
                <tr>
                    <th scope="col">Donation Meals</th>
                    <th scope="col">Upload Time</th>
                    <th scope="col">Expire Time</th>
                    <th scope="col">Collection Time</th>
                    <th scope="col">Amount (Kg/s)</th>
                    <th scope="col">Status</th>
                    <th scope="col">Collector ID</th>
                    <th scope="col">Collected</th>
                    <th scope="col">Cancel</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in ViewBag.Donations)
                {
                    <tr>
                        <td>@item.Name</td>
                        <td>@item.UploadDate</td>
                        <td>@item.ExpireTime</td>
                        <td>@(item.CompleteTime == null ? "-" : item.CompleteTime.ToString())</td>
                        <td>@item.Amount</td>
                        <td>@item.StatusName</td>
                        <td>@(item.AssignedTo == null ? "-" : item.AssignedTo)</td>
                        <td>
                            @if (item.StatusName == "Accepted")
                            {
                                <a href="/Restaurant/CollectedMeal/@item.Id?filter=@ViewBag.filter" class="btn btn-success">Collected</a>
                            }
                            else
                            {
                                <button class="btn btn-success" disabled>Collected</button>
                            }
                        </td>
                        <td>
                            @if (item.StatusName == "Pending" || item.StatusName == "Accepted")
                            {
                                <button class="btn btn-danger" onclick="confirmCancellation('@item.Id', '@ViewBag.filter')">Cancel</button>
                            }
                            else
                            {
                                <button class="btn btn-danger" disabled>Cancel</button>
                            }
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>
<script>
    function confirmCancellation(id, filter) {
        if (confirm("Are you sure you want to cancel this meal?")) {
            window.location.href = "/Restaurant/CancelledMeal/" + id + "?filter=" + filter;
        }
    }
</script>
